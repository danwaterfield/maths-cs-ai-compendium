<svg width="720" height="260" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="spec-arrow" markerWidth="7" markerHeight="5" refX="7" refY="2.5" orient="auto">
      <polygon points="0 0, 7 2.5, 0 5" fill="#555"/>
    </marker>
  </defs>
  <text x="360" y="22" fill="#333" font-size="14" font-weight="bold" text-anchor="middle">Speculative Decoding: Draft and Verify</text>

  <!-- Step 1: Draft model proposes -->
  <rect x="20" y="42" width="330" height="90" rx="10" fill="#3498db" opacity="0.05" stroke="#3498db" stroke-width="1.5"/>
  <text x="185" y="62" fill="#3498db" font-size="11" font-weight="bold" text-anchor="middle">Step 1: Draft model proposes k tokens (fast)</text>

  <rect x="35" y="75" width="50" height="28" rx="4" fill="#95a5a6" opacity="0.2" stroke="#333" stroke-width="1"/>
  <text x="60" y="94" fill="#333" font-size="10" text-anchor="middle">The</text>

  <line x1="85" y1="89" x2="95" y2="89" stroke="#3498db" stroke-width="1.5" marker-end="url(#spec-arrow)"/>

  <rect x="100" y="75" width="50" height="28" rx="4" fill="#3498db" opacity="0.15" stroke="#3498db" stroke-width="1.5"/>
  <text x="125" y="94" fill="#3498db" font-size="10" text-anchor="middle">cat</text>

  <line x1="150" y1="89" x2="160" y2="89" stroke="#3498db" stroke-width="1.5" marker-end="url(#spec-arrow)"/>

  <rect x="165" y="75" width="50" height="28" rx="4" fill="#3498db" opacity="0.15" stroke="#3498db" stroke-width="1.5"/>
  <text x="190" y="94" fill="#3498db" font-size="10" text-anchor="middle">sat</text>

  <line x1="215" y1="89" x2="225" y2="89" stroke="#3498db" stroke-width="1.5" marker-end="url(#spec-arrow)"/>

  <rect x="230" y="75" width="50" height="28" rx="4" fill="#3498db" opacity="0.15" stroke="#3498db" stroke-width="1.5"/>
  <text x="255" y="94" fill="#3498db" font-size="10" text-anchor="middle">in</text>

  <line x1="280" y1="89" x2="290" y2="89" stroke="#3498db" stroke-width="1.5" marker-end="url(#spec-arrow)"/>

  <rect x="295" y="75" width="50" height="28" rx="4" fill="#3498db" opacity="0.15" stroke="#3498db" stroke-width="1.5"/>
  <text x="320" y="94" fill="#3498db" font-size="10" text-anchor="middle">the</text>

  <text x="185" y="125" fill="#3498db" font-size="9" text-anchor="middle">Small model generates sequentially (cheap per token)</text>

  <!-- Step 2: Target model verifies -->
  <rect x="370" y="42" width="335" height="90" rx="10" fill="#e74c3c" opacity="0.05" stroke="#e74c3c" stroke-width="1.5"/>
  <text x="537" y="62" fill="#e74c3c" font-size="11" font-weight="bold" text-anchor="middle">Step 2: Target model verifies all at once</text>

  <rect x="385" y="75" width="50" height="28" rx="4" fill="#27ae60" opacity="0.15" stroke="#27ae60" stroke-width="2"/>
  <text x="410" y="94" fill="#27ae60" font-size="10" text-anchor="middle">cat</text>
  <text x="410" y="69" fill="#27ae60" font-size="14" text-anchor="middle">&#x2713;</text>

  <rect x="445" y="75" width="50" height="28" rx="4" fill="#27ae60" opacity="0.15" stroke="#27ae60" stroke-width="2"/>
  <text x="470" y="94" fill="#27ae60" font-size="10" text-anchor="middle">sat</text>
  <text x="470" y="69" fill="#27ae60" font-size="14" text-anchor="middle">&#x2713;</text>

  <rect x="505" y="75" width="50" height="28" rx="4" fill="#e74c3c" opacity="0.15" stroke="#e74c3c" stroke-width="2"/>
  <text x="530" y="94" fill="#e74c3c" font-size="10" text-anchor="middle">in</text>
  <text x="530" y="69" fill="#e74c3c" font-size="14" text-anchor="middle">&#x2717;</text>

  <text x="575" y="89" fill="#555" font-size="12">→</text>

  <rect x="590" y="75" width="50" height="28" rx="4" fill="#f39c12" opacity="0.2" stroke="#f39c12" stroke-width="2"/>
  <text x="615" y="94" fill="#f39c12" font-size="10" text-anchor="middle" font-weight="bold">on</text>
  <text x="660" y="94" fill="#666" font-size="8">resample</text>

  <text x="537" y="125" fill="#e74c3c" font-size="9" text-anchor="middle">Large model scores all k tokens in one forward pass</text>

  <!-- Result -->
  <rect x="120" y="148" width="480" height="45" rx="8" fill="#27ae60" opacity="0.06" stroke="#27ae60" stroke-width="1.5"/>
  <text x="360" y="167" fill="#27ae60" font-size="11" text-anchor="middle" font-weight="bold">Result: "The cat sat on" — accepted 2 of 4 draft tokens + 1 resampled</text>
  <text x="360" y="183" fill="#555" font-size="10" text-anchor="middle">Output distribution is identical to the target model. Draft model only affects speed.</text>

  <!-- Comparison -->
  <rect x="60" y="205" width="290" height="45" rx="8" fill="#3498db" opacity="0.06" stroke="#3498db" stroke-width="1"/>
  <text x="205" y="222" fill="#3498db" font-size="10" text-anchor="middle" font-weight="bold">Speculative Decoding</text>
  <text x="205" y="240" fill="#555" font-size="9" text-anchor="middle">Separate draft model proposes tokens</text>

  <rect x="370" y="205" width="290" height="45" rx="8" fill="#9b59b6" opacity="0.06" stroke="#9b59b6" stroke-width="1"/>
  <text x="515" y="222" fill="#9b59b6" font-size="10" text-anchor="middle" font-weight="bold">Medusa</text>
  <text x="515" y="240" fill="#555" font-size="9" text-anchor="middle">Extra prediction heads on the target model itself</text>
</svg>